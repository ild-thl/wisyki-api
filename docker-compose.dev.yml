# This compose file extends the main dlc docker-compose services
# It references postgres, pgadmin, and chroma from the main hub/docker-compose.yml
# To use both compose files together, run:
# docker-compose -f ../hub/docker-compose.yml -f docker-compose.dev.yml up

services:
  # Wisyki API service - connects to external postgres, pgadmin, and chroma from dlc compose
  wisyki-api:
    build:
      context: .
      dockerfile: Dockerfile.dev
    restart: unless-stopped
    volumes:
      - "./data:/code/data"
      - "./src:/code/src"
    env_file:
      - .env.dev
    ports:
      - "${HOST_PORT}:7680"
    depends_on:
      - postgres
      - chroma
    networks:
      - dlc
    environment:
      # External services configuration
      DB_HOST: postgres
      DB_PORT: 5432
      CHROMA_HOST: chroma
      CHROMA_PORT: 8000
      CHROMA_COLLECTION: wisyki-skills
      # HuggingFace Embedding API
      HF_EMBEDDING_HOST: "${HF_EMBEDDING_HOST}"
      HF_EMBEDDING_API_KEY: "${HF_EMBEDDING_API_KEY}"

networks:
  dlc:
    name: dlc
    external: true
